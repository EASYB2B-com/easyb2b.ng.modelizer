/**
 * easyb2b-ng-modelizer
 * @link 
 * @version v0.1.8
 * @license MIT
 */
!function(){"use strict";function e(e,t,r){function n(e,t){this._reset()}var i=function(e,t,r){r=Math.min(Math.max(r,0),e.length);var n,i=Array(e.length-r),o=t.length;for(n=0;n<i.length;n++)i[n]=e[n+r];for(n=0;n<o;n++)e[n+r]=t[n];for(n=0;n<i.length;n++)e[n+o+r]=i[n]};t.mixIn(n.prototype,{model:e,idAttribute:"id",preinitialize:function(){},initialize:function(){},parse:function(e,t){return e},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},push:function(e,t){return this.add(e,_.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},add:function(e,t){return this.set(e,_.extend({merge:!1},t,{add:!0,remove:!1}))},remove:function(e,t){t=_.extend({},t);var r=!_.isArray(e);e=r?[e]:e.slice();var n=this._removeModels(e,t);return r?n[0]:n},fetch:function(e,n){var i=r.$q.defer();e=_.extend({parse:!0},e);var o,s=this,u=e.url||_.result(s,"url")||t.urlError();return o=n?this.request.post(u,e.data,e):this.request.get(u,e),o=o.then(function(t){var r=e.set?"set":"reset";s[r](t.data,e),i.resolve(s)},function(e){i.reject(e)}),i.promise},get:function(e){if(null!=e)return this._byId[e.id]||this._byId[this.modelId(e)]||e.$modelId&&this._byId[e.$modelId]},set:function(e,t){if(null!=e){t=_.extend({},{add:!0,remove:!0,merge:!0},t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var r=!_.isArray(e);e=r?[e]:e.slice();var n,o,s=t.at,u=[],l=[],a={},d=t.add,c=t.merge,h=t.remove;for(o=0;o<e.length;o++){n=e[o];var f=this.get(n);if(f){if(c&&n!==f){var p=this._isModel(n)?n.getAttributes():n;t.parse&&(p=f.parse(p,t)),f.set(p,t)}a[f.$modelId]||(a[f.$modelId]=!0),e[o]=f}else d&&(n=e[o]=this._prepareModel(n,t),n&&(u.push(n),this._addModelReference(n,t),a[n.$modelId]=!0))}if(h){for(o=0;o<this.length;o++)n=this.models[o],a[n.$modelId]||l.push(n);l.length&&this._removeModels(l,t)}return u.length&&(i(this.models,u,null==s?this.length:s),this.length=this.models.length),r?e[0]:e}},reset:function(e,t){t=t?_.clone(t):{};for(var r=0;r<this.models.length;r++)this._removeModelReference(this.models[r],t);return this._reset(),e=this.add(e,_.extend({silent:!0},t))},create:function(e,t){t=t?_.clone(t):{};var r,n=this._prepareModel(e),i=this,o=t.wait;return o||i.add(n,t),r=n.save(),r.then(function(e){return o&&(i.add(n,t),i.add(n,t)),n},function(e){}),r},serialize:function(e){return _.map(this.models,function(t){return t.serialize(e)})},sync:function(){return n.sync.apply(this,arguments)},toJSON:function(e){return angular.toJson(this.serialize(e))}}),t.mixIn(n.prototype,{_addModelReference:function(e,t){this._byId[e.$modelId]=e;var r=this.modelId(e);null!=r&&(this._byId[r]=e)},_removeModelReference:function(e,t){delete this._byId[e.$modelId];var r=this.modelId(e);null!=r&&delete this._byId[r],this===e.$$collection&&delete e.$$collection},_reset:function(){this.length=0,this.models=[],this._byId={}},_removeModels:function(e,t){for(var r=[],n=0;n<e.length;n++){var i=this.get(e[n]);if(i){var o=this.indexOf(i);this.models.splice(o,1),this.length--,delete this._byId[i.$modelId];var s=this.modelId(i);null!=s&&delete this._byId[s],r.push(i),this._removeModelReference(i,t)}}return r},_prepareModel:function(e,t){if(this._isModel(e))return e.$$collection||(e.$$collection=this),e;t=t?_.clone(t):{},t.$$collection=this;var r=new this.model(e,t);return r},_isModel:function(t){return t instanceof e}}),n.sync=function(e,t,r){var n=o[e],i={method:n,dataType:"json"};r.url||(i.url=_.result(t,"url")||urlError()),null!=r.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(i.contentType="application/json",i.data=JSON.stringify(r.attrs||t.toJSON(r))),"GET"===i.type||r.emulateJSON||(i.processData=!1);var s=r.error;r.error=function(e,t,n){r.textStatus=t,r.errorThrown=n,s&&s.call(r.context,e,t,n)};var u=r.xhr=this.request(_.extend(i,r));return u};var o={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"},s={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};return t.addUnderscoreMethods(n,s,"models"),n.extend=function(e,r){var n="";return _.has(e,"model")&&(n=t.fnName(e.model),_.has(e,"url")||(e.url=e.model.prototype.urlRoot)),e.name=n+"Collection",t.extend.call(this,e,r)},n.request=n.prototype.request=r,n}function t(e,t,r){function n(e,t){var r=e||{};t=t||{},this.preinitialize.apply(this,arguments),this.$modelId=_.uniqueId(this.uidPrefix),this.$original=null,t.$$collection&&(this.$$collection=t.$$collection),t.parse&&(r=this.parse(r,t)||{});var n=_.result(this,"defaults");r=_.defaults(_.extend({},n,r),n),this.set(r,t),this.initialize.apply(this,arguments),t.keepOriginal&&this._setOriginal()}var i=["$$hashKey","$id","$modelId","$original","$selected","$destroyed","$$collection","idAttribute","metadata","urlRoot","__super__"];return t.mixIn(n.prototype,{idAttribute:"id",uidPrefix:"model_",preinitialize:function(){},initialize:function(){},isNew:function(){return!this.has(this.idAttribute)},has:function(e){return null!=this[e]},parse:function(e){return e},clone:function(){return new this.constructor(this)},set:function(e,t){e=e?e instanceof n?e.getAttributes():_.clone(e):{},t=t||{};var r=_.extend(this,e);return t.keepOriginal&&r._setOriginal(),r},url:function(){var e=_.result(this,"urlRoot")||_.result(this.$$collection,"url")||t.urlError();if(this.isNew())return e;var r=this[this.idAttribute];return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(r)},fetch:function(e,r){e=_.extend({parse:!0},e);var n,i=this,o=e.url||_.result(this,"url")||t.urlError();return n=r?this.request.post(o,e.data,e):this.request.get(o,e),n=n.then(function(t){var r=e.parse?i.parse(t.data,e):t;return i.set(r,e),i},function(e){return i.request.$q.reject(e)})},save:function(e){e=_.clone(_.extend({parse:!0},e));var t,r,n=this,i=n.isNew()?"post":e.patch?"patch":"put",o="patch"===i?n.serialize({changedOnly:!0}):n.serialize();return r=e.url||_.result(n,"url"),n.transformOnSave&&_.isFunction(n.transformOnSave)&&(o=n.transformOnSave(o,e)),_.extend(e,{url:r,data:o,method:i}),t=this.request(e).then(function(t){var r=e.parse?n.parse(t.data,e):t.data;return e.parse?(n.set(r,e),n):r},function(e){return n.request.$q.reject(e)})},destroy:function(e){e=e?_.clone(e):{};var t=this,r=function(){t.$$collection&&(t.$$collection.remove(t),delete t.$$collection),t.$$collection=null};if(this.isNew())return e.keepInCollections||r(),$q.when(!1);e.wait||e.keepInCollections||r();var n=e.url||_.result(t,"url"),i=this.request["delete"](n,e).then(function(){return e.wait&&!e.keepInCollections&&r(),t.$destroyed=!0,t},function(e){return t.request.$q.reject(e)});return i},hasChanged:function(e,t){var r=this,n=r.getChangedAttributes(t);return e||n===!1?!!n[e]&&!!n[e]:Object.keys(n).length>0},getAttributes:function(e){e=e||{};for(var t=this,r={},n=_.difference(Object.getOwnPropertyNames(t),i),o=0;o<n.length;o++){var s=Object.getOwnPropertyDescriptor(t,n[o]);s&&(s.get&&!s.set&&!e.includeComputed||s.set&&!s.get)||(r[n[o]]=t[n[o]])}return r},getChangedAttributes:function(e){var t={};if(this.$original){var r=n.diff(this.getAttributes(),this.$original,e);for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t},serialize:function(e){e=e||{};var t=e.changedOnly?this.getChangedAttributes(e):this.getAttributes(e);for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];i&&i instanceof n&&i.serialize&&(t[r]=i.serialize(_.extend({},e,{changedOnly:!1})))}return t},toJSON:function(e){return angular.toJson(this.serialize(e))}}),t.mixIn(n.prototype,{_setOriginal:function(e,t){this.$original=angular.copy(this.getAttributes())}}),n.diff=function(e,t,r){var i={};return r=r||[],_.each(e,function(o,s){if(!_.has(e,s)||r.indexOf(s)!==-1)return!0;if(_.isFunction(o))return!0;if(_.isObject(o)&&!_.isEqual(o,t[s]))if(_.isDate(o)){var u=new Date(o),l=new Date(t[s]);_.isEqual(u,l)||(i[s]=o)}else{var a=n.diff(o,t[s],r);_.isEmpty(a)||(i[s]=a)}return!o||_.isObject(o)||_.isEqual(o,t[s])?_.isEmpty(o)&&!_.isEmpty(t[s])?i[s]=o:void 0:i[s]=o}),i},n.request=n.prototype.request=r,n.extend=function(e,r){return e.name=e.name||"Model",t.extend.call(this,e,r)},n}function r(){function e(e,t){var r,n=this,i=e.name;return r=e&&_.has(e,"constructor")?e.constructor:new Function("p","return function "+i+"() { return p.apply(this, arguments); }")(n),_.extend(r,n,t),r.prototype=_.create(n.prototype,e),r.prototype.__super__=n,r.prototype.constructor=r,r.__super__=n.prototype,r}function t(e,t){return _.extend(e,t)}function r(){throw new Error('A "url" property or function must be specified')}function n(e){var t=e.toString();return t=t.substr("function ".length),t=t.substr(0,t.indexOf("(")),t?t.trim():t}function i(e,t){return _.isFunction(e)?e:_.isObject(e)&&!t._isModel(e)?o(e):_.isString(e)?function(t){return t.get(e)}:e}function o(e){var t=_.matches(e);return function(e){return t(e.attributes)}}var s=function(e,t,r){switch(e){case 1:return function(){return _[t](this[r])};case 2:return function(e){return _[t](this[r],e)};case 3:return function(e,n){return _[t](this[r],i(e,this),n)};case 4:return function(e,n,o){return _[t](this[r],i(e,this),n,o)};default:return function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this[r]),_[t].apply(_,e)}}},u=function(e,t,r){_.each(t,function(t,n){_[n]&&(e.prototype[n]=s(t,n,r))})};return{mixIn:t,extend:e,fnName:n,urlError:r,addUnderscoreMethods:u}}function n(e,t){function r(r){var n=t.defer();return e(_.extend({responseType:"json"},r)).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function n(e){var t=e.method||"",n=e.url,i=e.data||void 0;return r(_.extend({},e,{method:t.toUpperCase(),url:n,data:i}))}return _.extend(n,{$q:t,get:function(e,t){return r(_.extend({},t,{url:e,method:"GET"}))},post:function(e,t,n){return r(_.extend({},n,{url:e,method:"POST",data:t}))},put:function(e,t,n){return r(_.extend({},n,{url:e,method:"PUT",data:t}))},patch:function(e,t,n){return r(_.extend({},n,{url:e,method:"PATCH",data:t}))},"delete":function(e,t){return r(_.extend({},t,{url:e,method:"DELETE"}))}}),n}angular.module("easy.modelizer",["easy.modelizer.collection","easy.modelizer.model","easy.modelizer.utils"]),angular.module("easy.modelizer.collection",["easy.modelizer.model","easy.modelizer.utils","easy.modelizer.request"]).service("easyModelizerCollection",["easyModelizerModel","easyModelizerUtils","requestHelper",e]),angular.module("easy.modelizer.model",["easy.modelizer.utils","easy.modelizer.request"]).service("easyModelizerModel",["$injector","easyModelizerUtils","requestHelper",t]),angular.module("easy.modelizer.utils",[]).factory("easyModelizerUtils",[r]),angular.module("easy.modelizer.request",[]).factory("requestHelper",["$http","$q",n])}();